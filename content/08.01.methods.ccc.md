## Methods

The code needed to reproduce all of our analyses and generate the figures is available in [https://github.com/greenelab/ccc](https://github.com/greenelab/ccc).
We provide scripts to download the required data and run all the steps.
A Docker image is provided to use the same runtime environment.


### The CCC algorithm {#sec:ccc_algo .page_break_before}

The Clustermatch Correlation Coefficient (CCC) computes a similarity value $c \in \left[0,1\right]$ between any pair of numerical or categorical features/variables $\mathbf{x}$ and $\mathbf{y}$ measured on $n$ objects.
CCC assumes that if two features $\mathbf{x}$ and $\mathbf{y}$ are similar, then the partitioning by clustering of the $n$ objects using each feature separately should match.
For example, given $\mathbf{x}=(11, 27, 32, 40)$ and $\mathbf{y}=10x=(110, 270, 320, 400)$, where $n=4$, partitioning each variable into two clusters ($k=2$) using their medians (29.5 for $\mathbf{x}$ and 295 for $\mathbf{y}$) would result in partition $\Omega^{\mathbf{x}}_{k=2}=(1, 1, 2, 2)$ for $\mathbf{x}$, and partition $\Omega^{\mathbf{y}}_{k=2}=(1, 1, 2, 2)$ for $\mathbf{y}$.
The agreement between $\Omega^{\mathbf{x}}_{k=2}$ and $\Omega^{\mathbf{y}}_{k=2}$ can be computed using any measure of similarity between partitions, such as the adjusted Rand index (ARI) [@doi:10.1007/BF01908075], which in this case would return the maximum value (1.0).
However, the same value of $k$ may not be the optimal number of clusters to find a relationship between two features.
For instance, in the quadratic example in Figure @fig:datasets_rel, CCC returns a value of 0.36 when objects are grouped into four clusters using one feature and two using the other.
If we used only two clusters instead, CCC would return a similarity value of 0.02.
To address this, the CCC algorithm (shown below) searches for the optimal number of clusters given a maximum $k$, which is its single parameter $k_{\mathrm{max}}$.

![
](images/intro/ccc_algorithm/ccc_algorithm.svg "CCC algorithm"){width="75%"}

The algorithm `ccc` generates a list of partitionings $\Omega^{\mathbf{x}}$ and $\Omega^{\mathbf{y}}$ for each feature $\mathbf{x}$ and $\mathbf{y}$ (lines 14 and 15).
It then computes the Adjusted Rand Index (ARI) between each partition in $\Omega^{\mathbf{x}}$ and $\Omega^{\mathbf{y}}$ (line 16), keeping the pair that generates the maximum ARI.
Since ARI does not have a lower bound and could return negative values, which are not meaningful in our case, CCC returns only values between 0 and 1 (line 17).


The proposed correlation coefficient, CCC, can handle both linear and nonlinear relationships.
It requires a pair of partitions to compute a similarity value, and any feature that can be used to perform clustering/grouping is supported.
Numerical features are clustered using quantiles, from $k=2$ to $k=k_{\mathrm{max}}$.
Categorical features are grouped using their categories.
This allows for the integration of numerical and categorical variables, since clusters do not need an order.


For all our analyses, we used $k_{\mathrm{max}}=10$.
This value generates 18 partitions (9 for each gene, from $k=2$ to $k=10$) and 81 ARI comparisons.
Lowering $k_{\mathrm{max}}$ reduces computation time, but may miss more complex/general relationships.
Our examples in Figure @fig:datasets_rel suggest that using $k_{\mathrm{max}}=2$ could be a valid use case scenario to find linear-only patterns.
Additionally, $k_{\mathrm{max}}=2$ implies two partitions and one ARI comparison.
Our Python implementation of CCC provides flexibility in specifying $k_{\mathrm{max}}$.
For instance, a custom list of integers, such as `[2, 5, 10]`, can be used to partition the data into two, five, and ten clusters.


For a single pair of features (genes in our study), generating partitions or computing their similarity can be parallelized.
We used three CPU cores in our analyses to speed up the computation of CCC.
A future improved implementation of CCC could potentially use graphical processing units (GPU) to parallelize its computation further.


A Python implementation of CCC (optimized with `numba` [@doi:10.1145/2833157.2833162]) can be found in our Github repository [@url:https://github.com/greenelab/clustermatch-gene-expr], as well as a package published in the Python Package Index (PyPI) that can be easily installed.
