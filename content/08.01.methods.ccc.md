## Methods

The code needed to reproduce our analyses and generate the figures is available at [https://github.com/greenelab/ccc](https://github.com/greenelab/ccc).
We have provided scripts to download the necessary data and to run all steps.
Additionally, a Docker image is available to use the same runtime environment.


### The CCC algorithm {#sec:ccc_algo .page_break_before}

The Clustermatch Correlation Coefficient (CCC) computes a similarity value $c \in \left[0,1\right]$ between any two numerical or categorical features/variables $\mathbf{x}$ and $\mathbf{y}$ measured on $n$ objects.
CCC assumes that if two features $\mathbf{x}$ and $\mathbf{y}$ are similar, then the partitioning of the $n$ objects using each feature separately should match.
For example, given $\mathbf{x}=(11, 27, 32, 40)$ and $\mathbf{y}=10x=(110, 270, 320, 400)$, where $n=4$, partitioning each variable into two clusters ($k=2$) using their medians (29.5 for $\mathbf{x}$ and 295 for $\mathbf{y}$) would result in the same partition ($\Omega^{\mathbf{x}}_{k=2}=(1, 1, 2, 2)$ and $\Omega^{\mathbf{y}}_{k=2}=(1, 1, 2, 2)$).
The agreement between these two partitions can be measured using any measure of similarity between partitions, like the adjusted Rand index (ARI) [@doi:10.1007/BF01908075], which would return the maximum value (1.0 in this case).
Note that the same value of $k$ might not be the right one to find a relationship between any two features.
For instance, in the quadratic example in Figure @fig:datasets_rel, CCC returns a value of 0.36 (grouping objects in four clusters using one feature and two using the other).
If we used only two clusters instead, CCC would return a similarity value of 0.02.
Therefore, the CCC algorithm searches for the optimal number of clusters given a maximum $k$, which is its single parameter $k_{\mathrm{max}}$.

![
](images/intro/ccc_algorithm/ccc_algorithm.svg "CCC algorithm"){width="75%"}

The algorithm `ccc` generates a list of partitionings for each feature $\mathbf{x}$ and $\mathbf{y}$.
It then computes the ARI (adjusted Rand index) between each pair of partitions and keeps the pair that generates the maximum ARI.
Finally, CCC returns only values between 0 and 1 as ARI does not have a lower bound and negative values are not meaningful in this case.


CCC only requires a pair of partitions to compute a similarity value, so any type of feature can be used to group objects.
If the feature is numerical, quantiles are used to create clusters, ranging from $k=2$ to $k=k_{\mathrm{max}}$.
For categorical features, the categories are used to group objects.
This means that numerical and categorical variables can be combined since clusters do not need an order.


For all our analyses, we used $k_{\mathrm{max}}=10$.
This parameter determines the number of partitions generated for each gene pair (nine for each gene, from $k=2$ to $k=10$) and the number of ARI comparisons performed (81).
Reducing $k_{\mathrm{max}}$ can reduce computation time, but may miss more complex relationships.
Our examples in Figure @fig:datasets_rel suggest that using $k_{\mathrm{max}}=2$ only captures linear relationships, which can be a valid use case when only this kind of relationships are desired.
Additionally, $k_{\mathrm{max}}=2$ implies that only two partitions are generated, and only one ARI comparison is performed.
Our Python implementation of CCC provides flexibility in specifying $k_{\mathrm{max}}$; for example, the parameter can be a custom list of integers (e.g., `[2, 5, 10]`) to partition the data into two, five, and ten clusters.


We used three CPU cores to speed up the calculation of CCC for a single pair of features (genes).
To improve the efficiency of CCC, future implementations could utilize graphical processing units (GPUs) to further parallelize the computation.


A Python implementation of CCC (optimized with `numba`) is available in our Github repository and can be installed as a package from the Python Package Index (PyPI).
The DOI for the `numba` optimization is 10.1145/2833157.2833162, and the URL for our Github repository is https://github.com/greenelab/clustermatch-gene-expr.
