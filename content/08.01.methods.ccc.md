## Methods

The code used in our analyses and to generate the figures is available at [https://github.com/greenelab/ccc](https://github.com/greenelab/ccc).
We have provided scripts to download the necessary data and to run all the steps.
Additionally, a Docker image is available to ensure the same runtime environment.


### The CCC algorithm {#sec:ccc_algo .page_break_before}

The Clustermatch Correlation Coefficient (CCC) is a measure of similarity between any two numerical or categorical features/variables $\mathbf{x}$ and $\mathbf{y}$ measured on $n$ objects.
CCC assumes that if two features $\mathbf{x}$ and $\mathbf{y}$ are similar, then the partitioning by clustering of the $n$ objects using each feature separately should match.
To illustrate, given $\mathbf{x}=(11, 27, 32, 40)$ and $\mathbf{y}=10x=(110, 270, 320, 400)$, where $n=4$, partitioning each variable into two clusters ($k=2$) using their medians (29.5 for $\mathbf{x}$ and 295 for $\mathbf{y}$) would result in the same partition for both features ($\Omega^{\mathbf{x}}_{k=2}=(1, 1, 2, 2)$ and $\Omega^{\mathbf{y}}_{k=2}=(1, 1, 2, 2)$).
The agreement between these partitions can be computed using any measure of similarity between partitions, such as the adjusted Rand index (ARI) [@doi:10.1007/BF01908075].
In that case, it will return the maximum value (1.0 in the case of ARI).
It is important to note that the same value of $k$ might not be the best one to find a relationship between any two features.
For instance, in the quadratic example in Figure @fig:datasets_rel, CCC returns a value of 0.36 (grouping objects in four clusters using one feature and two using the other).
If we used only two clusters instead, CCC would return a similarity value of 0.02.
Therefore, the CCC algorithm searches for the optimal number of clusters given a maximum $k$, which is its single parameter $k_{\mathrm{max}}$.

![
](images/intro/ccc_algorithm/ccc_algorithm.svg "CCC algorithm"){width="75%"}

The algorithm 'ccc' generates a list of partitionings for each feature $\mathbf{x}$ and $\mathbf{y}$ (lines 14 and 15).
It then computes the Adjusted Rand Index (ARI) between each partition in $\Omega^{\mathbf{x}}$ and $\Omega^{\mathbf{y}}$ (line 16), and keeps the pair that generates the highest ARI.
Since ARI can return negative values, which are not meaningful, CCC returns only values between 0 and 1 (line 17).


CCC only requires two partitions to calculate a similarity value.
It supports any type of feature that can be used to group objects.
For numerical features (lines 2 to 5 in the `get_partitions` function), quantiles are used to generate clusters, ranging from 2 to $k_{\mathrm{max}}$.
Categorical features (lines 7 to 9) are grouped by their categories.
This allows numerical and categorical variables to be integrated since clusters do not need to be ordered.


For our analyses, we set $k_{\mathrm{max}}=10$, meaning that for each gene pair, 18 partitions were generated (9 for each gene, from $k=2$ to $k=10$) and 81 ARI comparisons were performed.
Lower values of $k_{\mathrm{max}}$ can reduce computation time, but may miss more complex/general relationships.
Our examples in Figure @fig:datasets_rel suggest that using $k_{\mathrm{max}}=2$ would lead to CCC finding linear-only patterns, which could be a valid use case scenario if only this kind of relationships are desired.
In this case, only two partitions would be generated and only one ARI comparison would be performed.
Our Python implementation of CCC provides flexibility in specifying $k_{\mathrm{max}}$.
For instance, instead of an integer for the maximum $k$, the parameter can be a custom list of integers, such as `[2, 5, 10]` which will partition the data into two, five and ten clusters.


We used three CPU cores to speed up the computation of the correlation coefficient (CCC) in our study on gene expression.
A future implementation of CCC could use graphical processing units (GPU) to parallelize its computation even further.
To generate partitions or compute the similarity of a single pair of features, parallelization can be employed.


A Python implementation of CCC, optimized with `numba` [@doi:10.1145/2833157.2833162], is available on our Github repository [@url:https://github.com/greenelab/clustermatch-gene-expr].
Additionally, a package for this implementation is published on the Python Package Index (PyPI) and can be easily installed.
